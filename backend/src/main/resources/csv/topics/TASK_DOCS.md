# Task Docs: [AKSEP] Disciplines to Topics planning (1/1)

## Mode & Score
Mode: plan-gate, Score: 6 (factors: touches >2 files, cross-file coupling, no tests, diff >50 LOC)

## Changes
- Schoolsystem2/backend/src/main/resources/scripts/topics/parse_disciplines.py: parse outline, default output to Disciplines_parsed.csv, layer shift (group=0), inline attached_to; defaults centralized; @codex replies added (SHA n/a)
- Schoolsystem2/backend/src/main/resources/scripts/topics/restructure_disciplines_csv.py: fix social-science/formal-science ordering, move social-work under sociology, add astronomy-over-chemistry priority, remove redundant taxonomy nodes, and keep Disciplines_restructured.csv contiguous (SHA n/a)
- Schoolsystem2/backend/src/main/resources/scripts/topics/enrich_disciplines_csv.py: add auto-description fallback, enrichment merge logic (override/append), misfire/missing-enrichment reporting, switch to Disciplines_enrichment.csv, and prune redundant attached_to covered by ancestors (SHA n/a)
- Schoolsystem2/backend/src/main/resources/csv/topics/Disciplines_enrichment.csv: rephrased descriptions to “Study of …”, manually enriched remaining disciplines, and removed self-referential/case-mismatched attached_to entries (SHA n/a)
- Schoolsystem2/backend/src/main/resources/csv/topics/Disciplines_restructured.csv: regenerated with communication/technology remaps, astronomy priority, and redundant-node removals (SHA n/a)
- Schoolsystem2/backend/src/main/resources/csv/topics/Disciplines_parsed.csv: generated parsed output from Disciplines_raw.md (SHA n/a)
- Schoolsystem2/backend/src/main/resources/csv/topics/Disciplines.csv: regenerated from Disciplines_restructured.csv via enrichment script (SHA n/a)
- Schoolsystem2/backend/src/main/resources/scripts/topics/check_branches_vs_disciplines.py: generate Branches_vs_Disciplines_review.csv with auto and fuzzy match columns for manual review (SHA n/a)
- Schoolsystem2/backend/src/main/resources/csv/topics/Branches_vs_Disciplines_review.csv: initialized review sheet with auto matches and placeholders for synonyms (SHA n/a)
- Schoolsystem2/backend/src/main/resources/csv/topics/TASK_PLAN.md: developer interactions updated (SHA n/a)
- Schoolsystem2/backend/src/main/resources/scripts/topics/restructure_disciplines_csv.py: add general/technical/practical override sets and derive type after layer computation (SHA n/a)
- Schoolsystem2/backend/src/main/resources/csv/topics/Disciplines_restructured.csv: regenerated with updated type markers (S0/T/P) (SHA n/a)
- Schoolsystem2/backend/src/main/resources/csv/topics/Disciplines.csv: regenerated with updated type values (SHA n/a)
- Schoolsystem2/backend/src/main/resources/scripts/topics/build_topic_planning_csv.py: generate t_topic_PLANNING.csv from Disciplines.csv + Achievements.csv using spreadsheet topicID logic (SHA n/a)
- Schoolsystem2/backend/src/main/resources/csv/topics/t_topic_PLANNING.csv: regenerated topics with achievements appended (SHA n/a)
- Schoolsystem2/backend/src/main/resources/scripts/topics/build_topic_planning_csv.py: update topicID logic to use phrase splitting, suffix normalization, and spec-word peeling (SHA n/a)
- Schoolsystem2/backend/src/main/resources/csv/topics/t_topic_PLANNING.csv: regenerated with updated topicID logic (SHA n/a)
- Schoolsystem2/backend/src/main/resources/scripts/topics/build_topic_planning_csv.py: add phrase-aware tokenization, suffix peels, and collision reporting for topicID generation (SHA n/a)
- Schoolsystem2/backend/src/main/resources/csv/topics/t_topic_PLANNING.csv: regenerated with updated topicID logic (SHA n/a)
- Schoolsystem2/backend/src/main/resources/scripts/topics/restructure_disciplines_csv.py: chain REPARENT_PREFIX remaps and reparent cultural-studies.asian-studies to sociology area-studies to fix missing parent refs (SHA n/a)
- Schoolsystem2/backend/src/main/resources/csv/topics/Disciplines_restructured.csv: regenerated after reparent chaining (2268 rows) (SHA n/a)
- Schoolsystem2/backend/src/main/resources/csv/topics/Disciplines.csv: regenerated after reparent chaining (2268 rows) (SHA n/a)
- Schoolsystem2/backend/src/main/resources/scripts/topics/sync_disciplines_enrichment.py: add non-destructive enrichment sync with status/suggested key handling (SHA n/a)
- Schoolsystem2/backend/src/main/resources/scripts/topics/enrich_disciplines_csv.py: skip orphan/suggested enrichment rows while preserving missing rows (SHA n/a)
- Schoolsystem2/backend/src/main/resources/csv/topics/Disciplines_enrichment.csv: regenerated with status/suggested key columns and aligned ordering (SHA n/a)
- Schoolsystem2/backend/src/main/resources/csv/topics/Disciplines.csv: regenerated after enrichment sync (2268 rows) (SHA n/a)
- Schoolsystem2/backend/src/main/resources/scripts/topics/sync_disciplines_enrichment.py: add apply-suggestions merge (non-destructive) to migrate suggested keys into valid rows (SHA n/a)
- Schoolsystem2/backend/src/main/resources/csv/topics/Disciplines_enrichment.csv: migrated suggested keys into valid rows, leaving orphans only (SHA n/a)
- Schoolsystem2/backend/src/main/resources/csv/topics/Disciplines.csv: regenerated after suggested-key migration (2268 rows) (SHA n/a)
- Schoolsystem2/backend/src/main/resources/csv/topics/Disciplines_enrichment.csv: migrated 118 orphan entries by unique name match and 4 manual key remaps; all orphans now have suggested key (SHA n/a)
- Schoolsystem2/backend/src/main/resources/csv/topics/Disciplines.csv: regenerated after orphan migrations (2268 rows) (SHA n/a)
- Schoolsystem2/backend/src/main/resources/scripts/topics/sync_disciplines_enrichment.py: add resolve-orphans option to collapse orphans into suggested keys and drop duplicates (SHA n/a)
- Schoolsystem2/backend/src/main/resources/csv/topics/Disciplines_enrichment.csv: resolved orphans and synced to Disciplines_restructured.csv order (2268 rows) (SHA n/a)
- Schoolsystem2/backend/src/main/resources/csv/topics/Disciplines.csv: regenerated after orphan resolution (2268 rows) (SHA n/a)
- Schoolsystem2/backend/src/main/resources/scripts/topics/parse_disciplines.py: capture outline URLs for h2/h3 headings (groups/discipline seeds) and write them into parsed output (SHA n/a)
- Schoolsystem2/backend/src/main/resources/csv/topics/Disciplines_parsed.csv: regenerated with outline URLs on layer 0/1 nodes (SHA n/a)
- Schoolsystem2/backend/src/main/resources/csv/topics/Disciplines_restructured.csv: regenerated to carry outline URLs forward (2268 rows) (SHA n/a)
- Schoolsystem2/backend/src/main/resources/csv/topics/Disciplines.csv: regenerated with updated outline URLs (2268 rows) (SHA n/a)
- Schoolsystem2/backend/src/main/resources/scripts/topics/parse_disciplines.py: capture hatnote main-article links for h2/h3 headings (prefer non-outline) (SHA n/a)
- Schoolsystem2/backend/src/main/resources/csv/topics/Disciplines_parsed.csv: regenerated with heading URLs from hatnotes (SHA n/a)
- Schoolsystem2/backend/src/main/resources/csv/topics/Disciplines_restructured.csv: regenerated to carry heading URLs forward (2268 rows) (SHA n/a)
- Schoolsystem2/backend/src/main/resources/csv/topics/Disciplines.csv: regenerated with updated heading URLs (2268 rows) (SHA n/a)
- Schoolsystem2/backend/src/main/resources/scripts/topics/restructure_disciplines_csv.py: add URL overrides for missing entries and seed URLs for added foundation rows (SHA n/a)
- Schoolsystem2/backend/src/main/resources/csv/topics/Disciplines_restructured.csv: regenerated with URL overrides (2268 rows; no missing URLs) (SHA n/a)
- Schoolsystem2/backend/src/main/resources/csv/topics/Disciplines_final.csv: regenerated with URL overrides (2268 rows; no missing URLs) (SHA n/a)
- Schoolsystem2/backend/src/main/resources/scripts/topics/restructure_disciplines_csv.py: remove invalid URL overrides after verification (SHA n/a)
- Schoolsystem2/backend/src/main/resources/csv/topics/Disciplines_restructured.csv: regenerated (2268 rows; 6 entries remain without URLs) (SHA n/a)
- Schoolsystem2/backend/src/main/resources/csv/topics/Disciplines_final.csv: regenerated (2268 rows; 6 entries remain without URLs) (SHA n/a)
- Schoolsystem2/backend/src/main/resources/scripts/topics/restructure_disciplines_csv.py: disambiguate duplicate names by URL tokens when URLs differ (SHA n/a)
- Schoolsystem2/backend/src/main/resources/scripts/topics/sync_disciplines_enrichment.py: resolve-orphans now merges any suggested key (SHA n/a)
- Schoolsystem2/backend/src/main/resources/csv/topics/Disciplines_restructured.csv: regenerated with URL-based disambiguation (2277 rows; 6 entries without URLs) (SHA n/a)
- Schoolsystem2/backend/src/main/resources/csv/topics/Disciplines_enrichment.csv: synced to 2277 rows after disambiguation (SHA n/a)
- Schoolsystem2/backend/src/main/resources/csv/topics/Disciplines_final.csv: regenerated after disambiguation (2277 rows) (SHA n/a)
- Schoolsystem2/backend/src/main/resources/csv/topics/t_topic_PLANNING.csv: regenerated after disambiguation (SHA n/a)
- Schoolsystem2/backend/src/main/resources/scripts/topics/build_topic_planning_csv.py: group typeID 0 rows to top after layer sort (SHA n/a)
- Schoolsystem2/backend/src/main/resources/csv/topics/t_topic_PLANNING.csv: regenerated with typeID 0 grouped first (SHA n/a)
- Schoolsystem2/backend/src/main/resources/scripts/topics/restructure_disciplines_csv.py: use display tokens (Outline_of ignored) in URL-based disambiguation (SHA n/a)
- Schoolsystem2/backend/src/main/resources/csv/topics/Disciplines_restructured.csv: regenerated after disambiguation tweak (2277 rows) (SHA n/a)
- Schoolsystem2/backend/src/main/resources/csv/topics/Disciplines_enrichment.csv: resynced to 2277 rows (SHA n/a)
- Schoolsystem2/backend/src/main/resources/csv/topics/Disciplines_final.csv: regenerated after disambiguation tweak (2277 rows) (SHA n/a)
- Schoolsystem2/backend/src/main/resources/csv/topics/t_topic_PLANNING.csv: regenerated after disambiguation tweak (2289 rows) (SHA n/a)
- Schoolsystem2/backend/src/main/resources/scripts/topics/restructure_disciplines_csv.py: add URL synonym normalization and case-aware prefix handling for disambiguation (SHA n/a)
- Schoolsystem2/backend/src/main/resources/csv/topics/Disciplines_restructured.csv: regenerated after synonym-aware disambiguation (2276 rows) (SHA n/a)
- Schoolsystem2/backend/src/main/resources/csv/topics/Disciplines_enrichment.csv: resynced to 2276 rows (SHA n/a)
- Schoolsystem2/backend/src/main/resources/csv/topics/Disciplines_final.csv: regenerated after synonym-aware disambiguation (2276 rows) (SHA n/a)
- Schoolsystem2/backend/src/main/resources/csv/topics/t_topic_PLANNING.csv: regenerated after synonym-aware disambiguation (2288 rows) (SHA n/a)
- Schoolsystem2/backend/src/main/resources/scripts/topics/restructure_disciplines_csv.py: disambiguate by common URL suffix when no shared prefix (SHA n/a)
- Schoolsystem2/backend/src/main/resources/csv/topics/Disciplines_restructured.csv: regenerated after suffix-based disambiguation (2276 rows) (SHA n/a)
- Schoolsystem2/backend/src/main/resources/csv/topics/Disciplines_enrichment.csv: filled missing descriptions for new entries (SHA n/a)
- Schoolsystem2/backend/src/main/resources/csv/topics/Disciplines_final.csv: regenerated after enrichment updates (2276 rows) (SHA n/a)
- Schoolsystem2/backend/src/main/resources/csv/topics/t_topic_PLANNING.csv: regenerated after enrichment updates (2288 rows) (SHA n/a)

## Checks & Results
- Manual run: python .../parse_disciplines.py --input .../Disciplines_raw.md => wrote 2574 rows
- Manual run: python .../restructure_disciplines_csv.py => rebuilt Disciplines_restructured.csv (2555 rows, no missing-parent errors, original order preserved)
- Manual run: python .../enrich_disciplines_csv.py => rebuilt Disciplines.csv (2555 rows; no warnings; no layer errors)
- Manual run: python .../check_branches_vs_disciplines.py => wrote Branches_vs_Disciplines_review.csv (802 rows)
- Manual run: python .../restructure_disciplines_csv.py => rebuilt Disciplines_restructured.csv with updated type markers (2555 rows)
- Manual run: python .../enrich_disciplines_csv.py => rebuilt Disciplines.csv with updated types (2555 rows)
- Manual run: python .../build_topic_planning_csv.py => wrote t_topic_PLANNING.csv (2567 rows)
- Manual run: python .../build_topic_planning_csv.py => wrote t_topic_PLANNING.csv (2567 rows) + collision report printed
- Manual run: python .../build_topic_planning_csv.py => wrote t_topic_PLANNING.csv after topicID logic update (2567 rows)
- Manual run: python .../restructure_disciplines_csv.py => rebuilt Disciplines_restructured.csv (2268 rows)
- Manual run: python .../enrich_disciplines_csv.py => rebuilt Disciplines.csv (2268 rows; warnings about missing enrichment/misfires)
- Manual run: python .../sync_disciplines_enrichment.py => rebuilt Disciplines_enrichment.csv (2567 rows; status columns)
- Manual run: python .../enrich_disciplines_csv.py => rebuilt Disciplines.csv (2268 rows; no warnings)
- Manual run: python .../sync_disciplines_enrichment.py --apply-suggestions => rebuilt Disciplines_enrichment.csv (2567 rows; 2268 valid / 299 orphan)
- Manual run: python .../enrich_disciplines_csv.py => rebuilt Disciplines.csv (2268 rows; no warnings)
- Manual run: python .../enrich_disciplines_csv.py => rebuilt Disciplines.csv after orphan migrations (2268 rows; no warnings)
- Manual run: python .../sync_disciplines_enrichment.py --resolve-orphans => rebuilt Disciplines_enrichment.csv (2268 rows)
- Manual run: python .../enrich_disciplines_csv.py => rebuilt Disciplines.csv after orphan resolution (2268 rows; no warnings)
- Manual run: python .../parse_disciplines.py --input .../Disciplines_raw.md => wrote 2574 rows
- Manual run: python .../restructure_disciplines_csv.py => rebuilt Disciplines_restructured.csv (2268 rows)
- Manual run: python .../enrich_disciplines_csv.py => rebuilt Disciplines.csv (2268 rows; no warnings)
- Manual run: python .../restructure_disciplines_csv.py => rebuilt Disciplines_restructured.csv (2268 rows)
- Manual run: python .../enrich_disciplines_csv.py => rebuilt Disciplines_final.csv (2268 rows; no warnings)
- Manual run: python .../restructure_disciplines_csv.py => rebuilt Disciplines_restructured.csv (2277 rows)
- Manual run: python .../sync_disciplines_enrichment.py --resolve-orphans => rebuilt Disciplines_enrichment.csv (2277 rows)
- Manual run: python .../enrich_disciplines_csv.py => rebuilt Disciplines_final.csv (2277 rows; no warnings)
- Manual run: python .../build_topic_planning_csv.py => wrote t_topic_PLANNING.csv (2289 rows)
- Manual run: python .../restructure_disciplines_csv.py => rebuilt Disciplines_restructured.csv (2276 rows)
- Manual run: python .../sync_disciplines_enrichment.py --resolve-orphans => rebuilt Disciplines_enrichment.csv (2276 rows)
- Manual run: python .../enrich_disciplines_csv.py => rebuilt Disciplines_final.csv (2276 rows; no warnings)
- Manual run: python .../build_topic_planning_csv.py => wrote t_topic_PLANNING.csv (2288 rows)
- Manual run: python .../restructure_disciplines_csv.py => rebuilt Disciplines_restructured.csv (2276 rows)
- Manual run: python .../enrich_disciplines_csv.py => rebuilt Disciplines_final.csv (2276 rows; no warnings)
- Manual run: python .../build_topic_planning_csv.py => wrote t_topic_PLANNING.csv (2288 rows)
- Manual run: python .../restructure_disciplines_csv.py => rebuilt Disciplines_restructured.csv (2277 rows)
- Manual run: python .../sync_disciplines_enrichment.py --resolve-orphans => rebuilt Disciplines_enrichment.csv (2277 rows)
- Manual run: python .../enrich_disciplines_csv.py => rebuilt Disciplines_final.csv (2277 rows; no warnings)
- Manual run: python .../build_topic_planning_csv.py => wrote t_topic_PLANNING.csv (2289 rows)
- Manual run: python .../build_topic_planning_csv.py => wrote t_topic_PLANNING.csv (2280 rows)
- Manual run: python .../restructure_disciplines_csv.py => rebuilt Disciplines_restructured.csv (2268 rows)
- Manual run: python .../enrich_disciplines_csv.py => rebuilt Disciplines_final.csv (2268 rows; no warnings)
- Manual run: python .../parse_disciplines.py --input .../Disciplines_raw.md => wrote 2574 rows
- Manual run: python .../restructure_disciplines_csv.py => rebuilt Disciplines_restructured.csv (2268 rows)
- Manual run: python .../enrich_disciplines_csv.py => rebuilt Disciplines.csv (2268 rows; no warnings)

## Manual Verification (if no tests)
- [x] Spot-checked chains: Humanities > Performing arts > Music > Conducting; Social science > Anthropology > Archaeology; Formal science > Computer science > Databases
- [x] Spot-checked topics output: top of t_topic_PLANNING.csv (layer ordering) and achievements appended at end
- [x] Spot-checked collision report output for high-frequency topicID prefixes

## Follow-ups / Risks
- If Disciplines.csv gets manual edits, avoid overwriting it with parser output; regenerate only Disciplines_parsed.csv and merge as needed.
- Heuristic mappings applied (review later): `humanities.languages-and-literature.*` split into `humanities.linguistics` vs `humanities.literature`; `natural-science.physical-science.*` split into `natural-science.physics`/`natural-science.chemistry`/`natural-science.earth-science`/`natural-science.physics.astronomy`; `natural-science.life-science.*` -> `natural-science.biology`; `social-science.anthropology.*` -> Sociology; `applied-science.*` moved under `social-science.communication` or `natural-science.physics.technology` (engineering-and-technology dissolved).

## Prompt override / deviations
- Proceeded despite pre-existing scope changes (many files already added/modified by the user) per explicit user instruction.
